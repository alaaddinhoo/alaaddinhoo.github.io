<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AWS IVS Real-Time Viewer</title>
  </head>
  <body>
    <div>
      <video
        id="video-player"
        autoplay
        muted
        playsinline
        style="width: 100%; height: auto"
      ></video>
    </div>

    <script>
      (async function () {
        const urlParams = new URLSearchParams(window.location.search);
        const participantToken = urlParams.get("participantToken");

        if (!participantToken) {
          console.error(
            "Participant token is missing. Please provide it as a query parameter in the URL."
          );
          return;
        }

        try {
          // Import the @aws-sdk/client-ivs-realtime package
          const { Stage } = await import(
            "https://cdn.jsdelivr.net/npm/@aws-sdk/client-ivs-realtime"
          );

          // Initialize the stage
          const stage = Stage(
            "arn:aws:ivs:ap-south-1:026090544993:stage/FFCYtpkh7PMx",
            { participantToken }
          );

          // Connect to the stage
          await stage.connect();

          // Access the local participant's video stream
          const videoElement = document.getElementById("video-player");
          const localParticipant = stage.getLocalParticipant();
          localParticipant.video.attach(videoElement);
        } catch (error) {
          console.error("Error connecting to AWS IVS Real-Time Stage:", error);
        }
      })();
    </script>
  </body>
</html>
